{% extends "base.html" %}

{% block js %}
<script type="text/javascript" src="{{ MEDIA_URL }}Scripts/funciones.js"></script>
<script type="text/javascript">
		$(document).ready(function(){
			$("#idCurso").change(function(){
				if ($(this).val() != -1){
					$.post("", {combo: 'idCurso', id: $(this).val()}, function(data){agregarOpciones(data, 'idModulo');}, "json");
				} else {
					$("#idModulo").html('');
					$("#idSesion").html('');
				}
			});
			
			$("#idModulo").change(function(){
				if ($(this).val() != -1){
					$.post("", {combo: 'idModulo', id: $(this).val()}, function(data){agregarOpciones(data, 'idSesion');}, "json");
				} else {
					$("#idSesion").html('');
				}
			});
		});		
</script>
{% endblock %}

{% block contenido %}
<div class="container">
    <div class="card">
        <div class="card-header">
            <h1>
                <legend>
                    <h3 class="f-700 f-20">Registro de Tareas</h3>
                </legend>
            </h1>
            {% if ok %}
                <div class="row">
                    <div class="alert alert-warning alert-dismissible" role="alert">
                        <button class="close" aria-label="close" data-dismiss="alert" type="button"><span aria-hidden="true">x</span></button>
                        <p>Se han registrado correctamente la entrega de tareas.</p>
                    </div>
                </div>
            {% endif %}
        </div>
        <form action="" method="POST" id="form_pasosTotal">
            {% csrf_token %}
            <div class="card-body card-padding">
                <br>
                <div class="row">
                    <div class="col-md-4">
                        <div class="input-group form-group">
                            <span class="input-group-addon">
                                <i class="zmdi zmdi-layers"></i>
                            </span>
                            <div class="fg-line requerido">
                                <label for="idCurso" class="fg-label requerido">Cursos:</label>
                                <select class="selectpicker" data-live-search="true" name="menuCursos" id="idCurso">
                                    <option value="-1" {% if not curso %} selected="selected" {% endif %}>Selecciona un curso</option>          
                                    {% for c in cursos %}
                                        <option value="{{ c.id }}" {% if c == curso %} selected="selected" {% endif %}>{{ c.nombre|capfirst }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="input-group">
                            <span class="input-group-addon">
                                <i class="zmdi zmdi-layers"></i>
                            </span>
                            <div class="fg-line requerido">
                                <label for="idModulo" class="fg-label requerido">M&oacute;dulos:</label>
                                <select class="selectpicker" data-live-search="true" name="menuModulos" id="idModulo">
                                    {% if  modulos %}
                                    <option value="-1" >Selecciona un MÃ³dulo</option>
                                    {% for m in modulos %}
                                        <option value="{{ m.id }}" {% if m == modulo %} selected="selected" {% endif %}>{{ m.nombre|capfirst }}</option>
                                    {% endfor %}    
                                {% endif %}
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="input-group">
                            <span class="input-group-addon">
                                <i class="zmdi zmdi-layers"></i>
                            </span>
                            <div class="fg-line requerido">
                                <label for="idSesion" class="fg-label requerido">Sesiones:</label>
                                <select class="selectpicker" data-live-search="true" name="menuSesiones" id="idSesion">
                                {% if  sesiones %}
                                    <option value="-1" >-----</option>          
                                    {% for s in sesiones %}
                                        <option value="{{ s.id }}" {% if s == sesion %} selected="selected" {% endif %}>{{ s.nombre|capfirst }}</option>
                                    {% endfor %}    
                                {% endif %}
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <br>
                <br>
                <div class="row">
                    <div class="col-md-4 col-md-offset-4">
                        <button type="submit" name ="verEstudiantes" class="btn btn-success btn-block">Ver</button>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <div class="card">
        <div class="card-header">
            <h1 class="f-700 f-20">
                <legend>
                    <h3>{% if not admin %}Mis{% endif %} Cursos</h3>
                    {% if admin %}<small><a alt="Agregar Curso" href="/academia/crear_curso/">Agregar Curso</a></small>{% endif %}
                </legend>
            </h1>
        </div>
        <form action="" method="POST">
            {% csrf_token %}
            <div class="card-body card-padding table-responsive">
                <br>
                <div class="row">
                    <div class="col-md-12">
                        <table id="tareas" class="table" cellspacing="0">
                            <thead>
                            <tr>              
                                <th class="checkboxBoton"><div class="button gray smallB checkBoton">
                                <input type="checkbox" name="checkBoton" class="checkBoton todos" onclick="checkTodos('tareas');"/></div></th>
                                <th>Nombre</th>
                            </tr>
                        </thead>
                        <tbody>      
                            {% for est in estudiantes %}
                            <tr>
                                <td><input type="checkbox" name="seleccionados" value="{{est.id}}" {% if est.tarea %}checked{% endif %}/></td>
                                <td>{{est.matricula.estudiante.nombre|capfirst}} {{est.matricula.estudiante.primerApellido|capfirst}} {{est.matricula.estudiante.segundoApellido|capfirst}}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td class="centrarTexto" colspan="2">No hay estudiantes en esta sesi&oacute;n.</td>
                            </tr>
                            {% endfor %}
                          </tbody> 
                        </table>
                    </div>
                </div>
                <br>
                <br>
                <div class="row">
                    <div class="col-md-4 col-md-offset-4">
                        <input type="hidden" name="menuCursos" value="{{curso.id}}"/>
                        <input type="hidden" name="menuModulos" value="{{modulo.id}}"/>
                        <input type="hidden" name="menuSesiones" value="{{sesion.id}}"/>
                        <button type="submit" class="btn btn-warning btn-block" name ="aceptarTarea">Registrar</button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>
{% endblock %}