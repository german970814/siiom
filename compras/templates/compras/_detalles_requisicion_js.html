<script>
	jQuery(document).ready(function($) {
        $("#data-table-command").on('loaded.rs.jquery.bootgrid', function(evento) {
            $('.proceso').click(function(event) {
                var $id = $(this).attr('data-row-id');
                $('input[name="id_requisicion"]').val($id);

                $.ajax({
                    url: '{% url "compras:detalles_requisicion_api" 0 %}'.replace('0', $id),
                    type: 'GET',
                    success: function(data) {
                        var arr = ['cantidad', 'descripcion', 'referencia', 'marca', 'valor_aprobado', 'total_aprobado', 'forma_pago'];
                        var to_append = '';
                        for (var i = 0; i < data.length; i++) {
                            var tr = '<tr>0</tr>'
                            var tds = '';
                            for (var j = 0; j < arr.length; j++) {
                                tds += '<td>0</td>'.replace('0', data[i][arr[j]])
                            }
                            to_append += tr.replace('0', tds);
                        }
                        $("#table-body").html(to_append);
                    }
                })
                $.ajax({
                    url: '{% url "compras:observaciones_requisicion" 0 %}'.replace('0', $id),
                    type: 'GET',
                    success: function(data) {
                        var arr = ['observacion', 'usuario'];
                        var div = '<div class="col-md-8">0</div>';
                        var h5 = '<h5>0</h5>';
                        var to_append = '';
                        var br = '<br />';
                        var quote = '<blockquote>0</blockquote>';

                        for (var i = 0; i < data[0].length; i++) {
                            str = h5.replace('0', data[0][i]['usuario']) + br + quote.replace('0', data[0][i]['observacion'])
                            to_append += div.replace('0', str);
                        }

                        $('#contenido').html(to_append)

                        if (data.length > 1 && data[1].length) {
                            var li = '<li><a href="0">!</a></li>';
                            var append = '';
                            for (var i = 0; i < data[1].length; i++){
                                append += li.replace('0', data[1][i]['ruta']).replace('!', data[1][i]['archivo'])
                            }
                            $('#archivos').fadeIn();
                            $('#archivos_list').html(append);
                        } else {
                            $('#archivos').fadeOut();
                        }
                    },
                });
                {% if not empleado %}
                $.ajax({
                    {% if jefe %}
                    url: '{% url "compras:requisicion_comentada_api" 0 %}'.replace('0', $id),
                    {% elif compras %}
                    url: '{% url "compras:requisicion_comentada_compras_api" 0 %}'.replace('0', $id),
                    {% elif jefe_administrativo %}
                    url: '{% url "compras:requisicion_comentada_jefe_administrativo_api" 0 %}'.replace('0', $id),
                    {% endif %}
                    type: 'GET',
                    success: function (data) {
                        if (data.length) {
                            if (eval(data)){
                                $('.to_hidden').fadeOut();
                            } else {
                                $('.to_hidden').fadeIn();
                            }
                        }
                    }
                })
                {% endif %}
                $('#toggleModal').click();
            })


            {% if CLICK %}
            var $id_to_error = '{{ CLICK }}';
            $('tr[data-row-id="' + $id_to_error + '"]').find('button.proceso').click();
            {% endif %}
        });
	});
</script>